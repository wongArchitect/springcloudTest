define("common-jquery:widget/js/logic/text2audio/text2audio.es",function(e,n){"use strict";function t(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(n,t,i){return t&&e(n.prototype,t),i&&e(n,i),n}}(),u=e("common-jquery:widget/js/util/audio-list/audio-list.es"),o=function(){function e(n){var i=n.url,o=void 0===i?"/article/ajax/loadtts?tex=":i,a=n.text,s=void 0===a?"":a,r=n.maxChunkSize,c=void 0===r?100:r,h=n.minChunkSize,l=void 0===h?20:h,d=n.onplay,f=void 0===d?function(){}:d,p=n.onpause,v=void 0===p?function(){}:p,m=n.onended,g=void 0===m?function(){}:m;t(this,e),this.url=o,this.maxChunkSize=c,this.minChunkSize=l,this.onplay=f,this.onpause=v,this.onended=g,this.paused=!0;var x=this;this.audioList=new u.AudioList({onplay:function(){x.paused=!1,x.onplay()},onpause:function(){x.paused=!0,x.onpause()},onended:function(){x.paused=!0,x.onended()}}),this.changeText(s)}return i(e,[{key:"changeText",value:function(e){function n(e){if(e.length<=i.maxChunkSize)return e;for(var n=[];e.length>i.maxChunkSize;)n.push(e.slice(0,i.maxChunkSize)),e=e.slice(i.maxChunkSize);return n.push(e),n}var t=this;if(this.text!==e){this.pause();var i=this;e=e.replace(/<\/?([^>]*)>/g,"$1"),e=e.trim().replace(/\s+/g," ");var u=e.split(/[,;.?!，；。？！]/);u=u.reduce(function(e,t){return e.concat(n(t))},[]),u=u.filter(function(e){return!/^\s*$/.test(e)}),u=u.reduce(function(e,n,t){return t>0&&n.length<i.minChunkSize&&n.length+e[e.length-1].length<i.maxChunkSize?(e[e.length-1]=e[e.length-1]+" "+n,e):e.concat(n)},[]),this.text=e,this.chunkList=u,this.audioList.changeUrlList(this.chunkList.map(function(e){return t.url+encodeURIComponent(e)}))}}},{key:"play",value:function(){this.audioList.play()}},{key:"pause",value:function(){this.audioList.pause()}}]),e}();n.Text2Audio=o});