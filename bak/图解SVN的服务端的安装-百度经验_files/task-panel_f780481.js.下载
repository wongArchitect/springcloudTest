define("common-jquery:widget/task-panel/task-panel.js",function(require,exports,module){var $=require("common-jquery:widget/lib/jquery/jquery.js"),ec=require("common-jquery:widget/js/util/event/event.js"),nslog=require("common-jquery:widget/js/logic/log/log.js");require("common-jquery:widget/js/logic/login/login.js");var $taskPanelEntrance=$(".task-panel-entrance"),$taskPanelWrap=$("#task-panel-wrap"),$taskPanelList=$(".task-panel-list"),$pageMask=$(".page-mask"),$taskWrap=$("#task-panel-task-wrap"),$taskContent=$(".task-content"),$taskMessage=$(".task-message"),$moneyWealth=$(".money-wealth"),$moneyCash=$(".money-cash"),$taskPanel=$(".task-panel"),$moneyAction=$(".money-action"),$body=$("body"),$triggerClick=$("#task-panel-trigger-click"),taskTpl=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push('<div class="single-task-content '),"签到"===task.name&&_template_fun_array.push("signin-content"),_template_fun_array.push('">    <div class="task-info">        <div class="task-name">',"undefined"==typeof task.name?"":baidu.template._encodeHTML(task.name),'</div>        <div class="task-desc">',"undefined"==typeof task.desc?"":baidu.template._encodeHTML(task.desc),'</div>        <div class="task-reward">            '),task.wealth&&_template_fun_array.push('                <div class="reward-money">+',"undefined"==typeof task.wealth?"":baidu.template._encodeHTML(task.wealth),"财富值</div>            "),_template_fun_array.push("            "),task.cash&&_template_fun_array.push('                <div class="reward-cash">+',"undefined"==typeof task.cash?"":baidu.template._encodeHTML(task.cash),"现金红包</div>            "),_template_fun_array.push('        </div>    </div>    <div class="task-status'),showProgress&&_template_fun_array.push(" task-status-progress"),_template_fun_array.push('">        '),showProgress?_template_fun_array.push('            <div class="task-action task-action-progress">                <div class="progress-bar-done" style="width: ',"undefined"==typeof(100*task.finishNum/task.stepNum)?"":baidu.template._encodeHTML(100*task.finishNum/task.stepNum),'%">                </div>                <div class="task-progress">已完成                    <div class="task-done">',"undefined"==typeof task.finishNum?"":baidu.template._encodeHTML(task.finishNum),'</div>/<div class="task-total">',"undefined"==typeof task.stepNum?"":baidu.template._encodeHTML(task.stepNum),"</div>                </div>            </div>        "):_template_fun_array.push('            <div class="task-action task-action-normal ',"undefined"==typeof task.actionClassName?"":baidu.template._encodeHTML(task.actionClassName),'"            data-status="',"undefined"==typeof task.status?"":baidu.template._encodeHTML(task.status),'"            data-jump="',"undefined"==typeof task.jump?"":baidu.template._encodeHTML(task.jump),'"            data-name="',"undefined"==typeof task.name?"":baidu.template._encodeHTML(task.name),'"            data-tid="',"undefined"==typeof task.tid?"":baidu.template._encodeHTML(task.tid),'"            data-wealth="',"undefined"==typeof task.wealth?"":baidu.template._encodeHTML(task.wealth),'"            data-cash="',"undefined"==typeof task.cash?"":baidu.template._encodeHTML(task.cash),'"            data-type="',"undefined"==typeof type?"":baidu.template._encodeHTML(type),'">                <span class="action-name">',"undefined"==typeof task.actionName?"":baidu.template._encodeHTML(task.actionName),'</span>                <div class="task-progress">已完成                    <div class="task-done">',"undefined"==typeof task.finishNum?"":baidu.template._encodeHTML(task.finishNum),'</div>/<div class="task-total">',"undefined"==typeof task.stepNum?"":baidu.template._encodeHTML(task.stepNum),"</div>                </div>            </div>        "),_template_fun_array.push("    </div></div>"),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],taslListTpl=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push('<div class="task-list">    <div class="task-type">        ',"undefined"==typeof type?"":baidu.template._encodeHTML(type),"        "),typeTip&&_template_fun_array.push('            <div class="task-question">                <div class="task-tip">                    <div class="triangle"></div>                    <div class="tip-text">',"undefined"==typeof typeTip?"":baidu.template._encodeHTML(typeTip),"</div>                </div>            </div>        "),_template_fun_array.push("    </div>    ","undefined"==typeof taskListStr?"":taskListStr,"</div>"),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],scrollbarwidth=window.innerWidth-document.body.clientWidth,entranceOpenRight=Math.max(.159*document.body.clientWidth,350)+scrollbarwidth,entranceCloseRight=0,isEntranceOpen=!1,scrollToSignInFlag=window.location.search.indexOf("10th_task_type=sign")>=0?!0:!1,openTaskPanelFlag=window.location.search.indexOf("openTaskPanel=1")>=0,gainRewardPendingTid={},actionStatus=[{name:"去做任务","class":"go-to-task"},{name:"领取奖励","class":"gain-reward"},{name:"已完成","class":"action-done"}],moneyJump={goods:"https://jingyan.baidu.com/shop/category",cash:"https://jingyan.baidu.com/user/nuc/income"},specialType={"日常任务":"任务每日重置；优质经验以提交后首次审核获得优质标签为准，悬赏经验要符合悬赏标准才算完成哦~","成就任务":"任务完成次数不限；累计优质经验以提交后首次审核获得优质标签来累计，累计悬赏任务要符合悬赏标准才可以累计哦~"},specialAction={"签到":"/utask/submit/signin","了解经验":"/utask/submit/knowexp","经验搜索":"/utask/submit/searchexp"},progressBarNames=["当日全勤","本周满签"],taskPanel={init:function(e){try{this.triggerFrom=e,this.setPanelRight(-entranceOpenRight),this.eventHandler(),(scrollToSignInFlag||openTaskPanelFlag)&&this.triggerOpenTaskPanel()}catch(a){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:a.message,path:"common-jquery:widget/task-panel/task-panel.js",method:"",ln:74})}},eventHandler:function(){var e=this;$taskPanelWrap.on("click",".task-panel-entrance",function(a){try{isEntranceOpen?(nslog.send(location.href,2019,{module:"common",page:e.triggerFrom,pos:"pc-task-panel-entrance",action:"click",isTaskListshow:!0,isLogin:F.context("isLogin")}),e.setEntranceClose()):(nslog.send(location.href,2019,{module:"common",page:e.triggerFrom,pos:"pc-task-panel-entrance",action:"click",isTaskListshow:!1,isLogin:F.context("isLogin")}),e.triggerOpenTaskPanel())}catch(a){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:a.message,path:"common-jquery:widget/task-panel/task-panel.js",method:"",ln:100})}}).on("click",".page-mask",function(a){try{nslog.send(location.href,2019,{module:"common",page:e.triggerFrom,pos:"pc-task-panel-mask",action:"click",isLogin:F.context("isLogin")}),e.setEntranceClose()}catch(a){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:a.message,path:"common-jquery:widget/task-panel/task-panel.js",method:"",ln:109})}}).on("click",".task-action-normal",function(a){try{var t=$(a.currentTarget),n=t.data("status"),s=t.data("jump"),i=t.data("name"),o=t.data("tid"),l=t.data("type"),d=t.data("wealth")||0,r=t.data("cash")||0;switch(nslog.send(location.href,2019,{module:"common",page:e.triggerFrom,pos:"pc-task-panel-action",action:"click",taskName:i,status:n,isLogin:F.context("isLogin")}),n){case 0:F.context("isLogin")?e.goToTask(s,i,o):ec.fire("login.log");break;case 1:e.gainReward(o,l,d,r)}}catch(a){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:a.message,path:"common-jquery:widget/task-panel/task-panel.js",method:"",ln:140})}}).on("click",".money-action",function(a){try{var t=$(a.currentTarget),n=t.data("type");nslog.send(location.href,2019,{module:"common",page:e.triggerFrom,pos:"task-panel-money-item",action:"click",type:n,isLogin:F.context("isLogin")}),F.context("isLogin")?e.jumpToUrl(moneyJump[n]):ec.fire("login.log")}catch(a){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:a.message,path:"common-jquery:widget/task-panel/task-panel.js",method:"",ln:156})}}).on("mouseenter mouseleave",".task-question",function(e){var a=$(e.currentTarget),t=a.children(".task-tip");"mouseenter"===e.type?t.addClass("task-tip-show"):t.removeClass("task-tip-show")})},triggerOpenTaskPanel:function(){this.showMessage("数据加载中..."),this.setEntranceOpen(),this.getPanelData()},gainReward:function(e,a,t,n){var s=this;gainRewardPendingTid[e]||(gainRewardPendingTid[e]=1,$.ajax({url:"/utask/submit/getreward",method:"POST",dataType:"json",data:{tid:e,bdStoken:F.context("BdStoken"),bdstt:F.context("bdstt")},success:function(i){0===i.errCode?(nslog.send(location.href,2019,{module:"common",page:s.triggerFrom,pos:"task-panel-gain-reward",isLogin:F.context("isLogin"),wealth:t,cash:n}),s.getPanelData("成就任务"===a?e:"")):gainRewardPendingTid[e]=0},fail:function(){gainRewardPendingTid[e]=0}}))},goToTask:function(e,a,t){var n=this;specialAction[a]?$.ajax({url:specialAction[a],method:"POST",data:{tid:t,bdStoken:F.context("BdStoken"),bdstt:F.context("bdstt")},dataType:"json",success:function(a){0===a.errCode&&(e?n.jumpToUrl(e):n.getPanelData())}}):this.jumpToUrl(e)},jumpToUrl:function(e){$triggerClick.attr("href",e),$triggerClick[0].click()},setEntranceOpen:function(){$pageMask.addClass("page-mask-show"),$taskPanelList.css("visibility","visible"),this.setEntranceRight(entranceOpenRight),this.setPanelRight(0),isEntranceOpen=!0,$body.css("overflow","hidden")},setEntranceClose:function(){this.setEntranceRight(entranceCloseRight),this.setPanelRight(-entranceOpenRight),$pageMask.removeClass("page-mask-show"),$taskPanelList.css("visibility","hidden"),isEntranceOpen=!1,$body.css("overflow","scroll")},setEntranceRight:function(e){$taskPanelEntrance.css("right",e+"px")},setPanelRight:function(e){$taskPanel.css("right",e+"px")},showMessage:function(e){$taskContent.removeClass("task-content-show"),$taskPanel.addClass("task-panel-fixed-height"),$taskMessage.text(e),$taskMessage.addClass("task-message-show")},hideMessage:function(){$taskMessage.removeClass("task-message-show"),$taskPanel.removeClass("task-panel-fixed-height"),$taskContent.addClass("task-content-show")},getPanelData:function(e){var a=this;$.ajax({url:"/utask/ajax/task",method:"POST",data:{bdStoken:F.context("BdStoken"),bdstt:F.context("bdstt")},dataType:"json",success:function(t){if(0===t.errCode){var n=t.data.data;if(a.renderPanelData(n,e),a.hideMessage(),scrollToSignInFlag){var s=$(".single-task-content.signin-content").offset().top-60;$($taskPanelList).animate({scrollTop:s+"px"},800),scrollToSignInFlag=!1}}else a.showMessage("数据加载错误，请稍后再试~");gainRewardPendingTid={}}})},renderPanelData:function(e,a){var t=e.wealth||0,n=e.cash||0,s=e.freshTask||[],i=e.dailyTask||[],o=e.growupTask||[];$moneyWealth.text(F.context("isLogin")?t:"--"),$moneyCash.text(F.context("isLogin")?n:"--");var l=[{type:"新手任务",data:s},{type:"日常任务",data:i},{type:"成就任务",data:o}],d=this.genHtml(l,a);$taskWrap.empty().append(d)},genHtml:function(e,a){var t=this;return e.reduce(function(e,n){return e+t.genTaskHtml(n,a)},"")},genTaskHtml:function(e,a){var t=this;if(!e.data.length)return"";var n=e.data.reduce(function(n,s){return n+t.genTaskItemHtml(s,e.type,a)},""),s=taslListTpl({type:e.type,typeTip:specialType[e.type],taskListStr:n});return s},genTaskItemHtml:function(e,a,t){t&&t===e.tid&&(e.status=2);var n=0===e.status&&"签到"===e.name?"签到":actionStatus[e.status].name;e.actionName=n,e.actionClassName=actionStatus[e.status].class;var s=F.context("isLogin")&&0===e.status&&progressBarNames.indexOf(e.name)>-1,i=taskTpl({showProgress:s,task:e,type:a});return i}};module.exports=taskPanel});